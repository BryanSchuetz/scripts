module Cartograph
  module Installer
    @gem_file = File.join($data_dir, "cartograph.gemfile")
    @gem_file_contents = <<-GEMFILE
      source 'https://rubygems.org'
      gem 'eol-cartograph'
    GEMFILE

    def self.write_gem_file()
      return if Script.exists?(@gem_file)
      File.write(@gem_file, @gem_file_contents)
    end

    def self.setup()
      write_gem_file
      pp(`bundle install --gemfile=#{@gem_file}`)
    end
  end
end
# create the Gemfile
Cartograph::Installer.setup()
# refresh paths so we can require the MapDB
Gem.clear_paths
# load the Cartograph gem for usage
require 'eol-cartograph'
# print some info to the end user
Log.out("cartograph/mapdb is using v#{Cartograph::VERSION}",
  label: :version)
# todo: this should be wrapped in some sort of Thread-safe Mutex
Map.clear
Map.load_json(Cartograph.map_file)